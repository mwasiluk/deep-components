
<link rel="import" href="../odc-d3-datalet/odc-d3-datalet.html">


<dom-module id="regression-datalet">
    <template>
        <style is="custom-style">
            :host ::content #scatterplot-placeholder {
                width: 100%;

                background: #ffffff;
                position: relative;
            }
        </style>
        <odc-d3-datalet id="charts" data-url="{{dataUrl}}" fields="{{fields}}" title="{{title}}" description="{{description}}" export_menu="{{export_menu}}" data="{{data}}"></odc-d3-datalet>
    </template>
    <script>

        var RegressionBehavior = {
            presentData: function () {

                var self =this;
                var conf = {
                    x:{
                        key: this.properties.selectedFields[0].value,
                        title: self._component.xAxisLabel
                    },
                    y:{
                        key: this.properties.selectedFields[1].value,
                        title: self._component.yAxisLabel
                    },
                    guides: true,
                    tooltip: true,
                    mainRegression: self._component.mainRegression,
                    groupRegression: self._component.groupRegression,
                    confidence:{
                        level: self._component.confidence
                    }
                };

                if(this.properties.groupKey){
                    conf.groups= {
                        key: self.properties.groupKey
                    }
                }

                console.log(conf, this.properties.data);


                var plot = new ODCD3.Regression(this._component.$.charts.$.container, this.properties.data, conf);
            }
        };

        RegressionDatalet = Polymer({
            is: 'regression-datalet',
            properties: {
                data: {
                    type: Array,
                    value: undefined
                },
                xAxisLabel: {
                    type: String,
                    value: ""
                },
                yAxisLabel: {
                    type: String,
                    value: ""
                },
                mainRegression: {
                    type: Boolean,
                    value: true
                },
                groupRegression: {
                    type: Boolean,
                    value: true
                },
                confidence: {
                    type: Number,
                    value: 0.95
                },
                behavior : {
                    type : Object,
                    value : {}
                },
                /**
                 * Control the export menu
                 * xxxx BITMASK. FROM RIGHT : HTML, PNG, RTF, MY SPACE (eg. 1111 show all, 0000 hide all)
                 *
                 * @attribute export_menu
                 * @type Number
                 * @default 15
                 */
                export_menu : {
                    type  : Number,
                    value : 15 // xxxx BITMASK. FROM RIGHT : HTML, PNG, RTF, MY SPACE (eg. 1111 show all, 0000 hide all)
                }
            },

            /**
             * 'ready' callback extend the scatterchartComponentBehavior with HighchartsComponentBehavior and scatterchartBehavior
             * and run the Datalet workcycle.
             *
             * @method ready
             */
            ready: function(){
                this.behavior = $.extend(true, {}, OdcD3ComponentBehavior, RegressionBehavior);
                this.async(function(){this.behavior.init(this)},0);
            }
        });
    </script>
</dom-module>